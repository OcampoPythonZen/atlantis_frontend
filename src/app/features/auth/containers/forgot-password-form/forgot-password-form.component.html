<div class="animate-fade-in-up">
  @if (!emailSent()) {
    <!-- Request Form -->
    <div class="text-center mb-8">
      <div class="w-16 h-16 bg-primary-100 dark:bg-primary-900/30 rounded-full flex items-center justify-center mx-auto mb-6">
        <svg class="w-8 h-8 text-primary-600 dark:text-primary-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
        </svg>
      </div>

      <h1 class="text-2xl sm:text-3xl font-display font-semibold text-dark-900 dark:text-dark-50">
        Recuperar contraseña
      </h1>
      <p class="mt-2 text-dark-600 dark:text-dark-400">
        Te enviaremos un enlace para restablecer tu contraseña
      </p>
    </div>

    <!-- Error Alert -->
    @if (authError()) {
      <div
        class="mb-6 p-4 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"
        role="alert"
      >
        <div class="flex items-center gap-3">
          <svg class="w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
          </svg>
          <p class="text-sm text-red-700 dark:text-red-300">{{ authError() }}</p>
        </div>
      </div>
    }

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-5">
      <!-- Email Input -->
      <app-input
        formControlName="email"
        label="Correo electrónico"
        type="email"
        placeholder="tu@correo.com"
        autocomplete="email"
        [required]="true"
        [error]="getError('email')"
      />

      <!-- Submit Button -->
      <button
        type="submit"
        class="btn-primary w-full flex items-center justify-center gap-2 h-12"
        [disabled]="form.invalid || isLoading()"
      >
        @if (isLoading()) {
          <app-spinner size="sm" />
          <span>Enviando...</span>
        } @else {
          <span>Enviar enlace</span>
        }
      </button>
    </form>
  } @else {
    <!-- Success State -->
    <div class="text-center">
      <div class="w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-6">
        <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>

      <h1 class="text-2xl sm:text-3xl font-display font-semibold text-dark-900 dark:text-dark-50">
        ¡Correo enviado!
      </h1>
      <p class="mt-2 text-dark-600 dark:text-dark-400 max-w-sm mx-auto">
        Hemos enviado un enlace a <strong class="text-dark-900 dark:text-dark-100">{{ submittedEmail() }}</strong>
        para restablecer tu contraseña.
      </p>

      <p class="mt-4 text-sm text-dark-500 dark:text-dark-400">
        ¿No recibiste el correo? Revisa tu carpeta de spam o
        <button
          type="button"
          class="link-primary"
          (click)="resetForm()"
        >
          intenta de nuevo
        </button>
      </p>
    </div>
  }

  <!-- Back to Login Link -->
  <div class="mt-8 text-center">
    <a
      routerLink="../login"
      class="inline-flex items-center gap-2 text-dark-600 dark:text-dark-400 hover:text-dark-900 dark:hover:text-dark-100 transition-colors"
    >
      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
      </svg>
      Regresar al inicio de sesión
    </a>
  </div>
</div>
